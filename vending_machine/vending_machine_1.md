# 自動販売機を模倣してみよう！その１

## 1. まずはオブジェクト指向について理解しよう
自動販売機を模倣する前に、まずはオブジェクト指向についてもう少し理解していきましょう。  
まずは、下記の記事を読んでください。  
https://codezine.jp/article/detail/10215  

この記事が言いたいことを、自動販売機を例に挙げて解説していきます。

### 1.1. 継承

> 　左の生物から右の会社社員まで、「生きている」「動く」「食べる」など同じ特徴を共有している関係を継承と呼びます。  
> オブジェクト指向では、実装の際に抽象クラスが持つ機能を具体クラスに継承することができるのです。

自動販売機でも「抽象クラスが持つ機能を具体クラスに継承する」ものが作れますね

例えば商品。  
「缶」も「ペットボトル」も「お菓子」も「商品」として売られていますね。  
つまり、これらは **「商品」という抽象クラスが持つ機能を具体クラスに継承しているもの** だといえます。

Ruby で書いてみるとこんな感じになります。

```ruby
class Product
  attr_reader :name, :price
end

class Canned < Product
end

class PetBottled < Product
end

class Snack < Product
end
```

「商品」という抽象クラスが持つ機能を具体クラスである「缶」、「ペットボトル」、「お菓子」が継承していますね。  
こんな感じに特徴を共有することで、クラスを抽象的にまとめることができます。

```
------- Product --------
|  Canned              |
|           PetBottled |
|       Snack          |
------------------------
```

### 1.2. カプセル化

> カプセル化とは、オブジェクトにカバーを被せて中身を隠してしまうようなことです。  
> （中略）  
> データや機能がばらばらに分散していると、誰に何を尋ねればいいのかわからなくなってしまいますが、カプセル化を利用するとデータや機能の範囲が明確になります。

商品を購入するまでの順序（商品を購入するプロセス）を例にあげます。  
こんな感じにプログラムが書かれていたら、あなたはどう思いますか？

```ruby
# 自動販売機を作成する
products = []
products << PetBottled.new("ずんだジュース", 160)
products << PetBottled.new("微炭酸サイダー", 160)
products << Snack.new("無糖コーヒー飴", 130)

# 自動販売機を起動する
loop do
  # 商品を購入するか尋ねる
  # y が入力されたら次の処理に移行する
  # n が入力されたら終了する
  # y か n が入力されるまで動作を繰り返す
  print "商品を購入しますか？ y/n: "
  loop do
    is_purchase = gets.chomp
    break if is_purchase == "y" || is_purchase == "n"
    print "yかnを入力してください: "
  end
  break if is_purchase == "n"

  # 商品を選択させる
  puts "次の中から商品を選択してください:"
  # ...
end
```

一見すると「普通だなあ」って思うかもしれません。  
でも一つのファイルに書くと煩雑になりませんか？

こんな感じに書いたプログラムを数日置いてから見ると、「なんだこれ？」ってなることがしばしばあります。  
ちなみに私がはじめて書いた Ruby プログラムは、今読むと何を書いているか全くわかりませんでした...  
もちろんそのプログラムはちゃんと動作します。ただ、読めないんです。

今の私ならこのプログラムを次のように書き換えます。

```ruby
# 自動販売機を作成する
vending_machine = VendingMachine.new

# 自動販売機を起動する
vending_machine.start_up
```

「いやまて、これじゃ動かないでしょ！」というクレームは受け付けていません。  
たしかにこれだけじゃ動きませんが、この VendingMachine クラスは別ファイルで次のように定義します。

```ruby
class VendingMachine
  attr_accessor :products, :return_change

  def initialize
    # 商品を自動販売機に入れる
    @products      = Product.import_product

    # お金を計算するクラスを導入する
    @return_change = ReturnChange.new
  end

  def start_up
    loop do
      # 商品を購入するか尋ねる
      # y が入力されたら次の処理に移行する
      # n が入力されたら終了する
      # y か n が入力されるまで動作を繰り返す
      ask_want_to_purchase

      # 商品を選択させる
      ask_choose_product

      # ...
    end
  end

  private
    # 商品を購入するか尋ねる
    # y が入力されたら次の処理に移行する
    # n が入力されたら終了する
    # y か n が入力されるまで動作を繰り返す
    def ask_want_to_purchase
      print "商品を購入しますか？ y/n: "
      loop do
        is_purchase = gets.chomp
        break if is_purchase == "y" || is_purchase == "n"
        print "yかnを入力してください: "
      end
      break if is_purchase == "n"
    end

    # 商品を選択させる
    def ask_choose_product
      # ...
    end

    # ...
end
```

こんな感じに書くと、**どのメソッドがどのような動きをしているのかが明確になります**。  
また、メソッドを分けることによって **メソッドの単純化ができ、管理しやすい** というメリットがあります。  
他にもいろいろ利点がありますが、ここでは割愛します。

**機能とデータの範囲を明確にすること** をカプセル化っていうんだなっていう認識で OK です。  

### 1.3. ポリモーフィズム

> 社員は全員起立のメソッドを継承していますから、立ち上がりはするわけです。   
> （中略）  
> 社員側で起立の仕方を変えたり、起立の仕方が違う社員を用意したりすれば、多様な起立の仕方に対応できることになります。この多様なあり方をポリモーフィズムといいます。

買われた商品を自動販売機から出すメソッドを考えます。  
この時、お菓子と缶・ペットボトルの出口はぞれぞれ違いますよね？  
逆に、同じ出口を使用している自動販売機もあるかもしれません。

つまり、**自販機の仕様や商品の種類によって、買われた商品を自動販売機から出す方法が変化する**ことになります。  
このような多様なあり方をポリモーフィズムといいます。  
オブジェクト指向は、このような考え方に対応しています。

買われた商品を自動販売機から出すメソッドを、ポリモーフィズムの考えで書いてみます。

```ruby
class Product
  attr_reader :name, :price

  def output
    # 缶・ペットボトルを出すための出口から出す
  end
end

class PetBottled < Product
  # 缶・ペットボトルを出すための出口から出す
  # 定義しなくても親クラスからメソッドを引き継いでいます
  # def output
  #   super
  # end
end

class Snack < Product
  def output
    # お菓子を出すための出口から出す
    # 親クラスのメソッドを上書きしています！
  end
end
```

こんな感じに、買われた商品を自動販売機から出す方法を各クラスに合わせて変化させることが可能となっています。  
これもオブジェクト指向の長所です。

### 1.4. まとめ

オブジェクト指向について簡単にまとめてみます。

オブジェクト指向が取り込まれたプログラミング言語では次の 3 つのことができます:
　
* 継承: 抽象クラスが持つ機能を具体クラスに継承することができる
* カプセル化: 機能とデータの範囲を明確にすることができる
* ポリモーフィズム: 親クラスから派生した、多様な子クラスの仕様に対応することができる

### 1.5. さいごに

次回はオブジェクト指向をもとに、自動販売機のプログラムを設計していきます。

<その２制作中...>
