# 20 を数えたら負けゲームを作ってみよう

Progate Ruby を学習した人、あるいは CODEPREP で学習した人、  
プログラミングに慣れてもらうために、Ruby で 20 を数えたら負けゲームをターミナルで作ってみましょう！

## 1. ゲームについて

ゲームを知らない、やったことがない方もいると思うので、まずはゲームについて解説していきます。

1. プレイヤーは 2 人です
2. 1 から連続する整数を順番に数えていきます
3. 1 人は 1 度に 1 つから 3 つまでの数を数えることができます
    * 10 まで数えられていれば、次の人は 11 ~ 13 を数えることができます
4. 20 を数えてしまった人が負けです。

ちなみに、先攻が必ず勝てるゲームです...

```
$ ruby ruby_game_1/app.rb
先攻プレイヤーさん、 数える数字を選択してください
[1] 1, [2] 2, [3] 3
3
後攻プレイヤーさん、 数える数字を選択してください
[1] 4, [2] 5, [3] 6
2
先攻プレイヤーさん、 数える数字を選択してください
[1] 6, [2] 7, [3] 8
2
後攻プレイヤーさん、 数える数字を選択してください
[1] 8, [2] 9, [3] 10
3
先攻プレイヤーさん、 数える数字を選択してください
[1] 11, [2] 12, [3] 13
1
後攻プレイヤーさん、 数える数字を選択してください
[1] 12, [2] 13, [3] 14
1
先攻プレイヤーさん、 数える数字を選択してください
[1] 13, [2] 14, [3] 15
3
後攻プレイヤーさん、 数える数字を選択してください
[1] 16, [2] 17, [3] 18
3
先攻プレイヤーさん、 数える数字を選択してください
[1] 19, [2] 20
1
後攻プレイヤーさん、 数える数字を選択してください
[1] 20
2
出力された選択肢のなかから選んでください！
0
出力された選択肢のなかから選んでください！
p
出力された選択肢のなかから選んでください！
1
先攻プレイヤーさんの勝利です！
```

## 2. 回答

### 2.1. ゲームを進行する方法

ゲームを進行するためには、同じ処理を何度も繰り返す方が楽です。  
基本的には loop do という関数を使用します。

```ruby
## 使用する関数を定義する

loop do
  ## ゲームを進行するプログラムを書く
end
```

※ 制作中に loop do から出られなくなった場合は:  
Windows: ctrl+C  
Mac: control+C  
で強制終了させることができます

試しに loop do を使って、1 を入力すると終了するゲームを作ってみます。

```ruby
## 使用する関数を定義する
request_num = 0 # 選択された番号を入れる

## ゲームスタート！
loop do
  ## 出力された選択肢のなかから選ばれていれば終了する
  ## そうでなければ、出力された選択肢のなかからもう一度選択してもらう
  puts "1 を入力してください"
  request_num = gets.to_i
  if request_num == 1
    break
  end
end
```

### 2.2. 20 までをカウントしよう

お次は 20 までカウントするプログラムの製作です。  
数字を 20 まで数えるには、カウントするための変数が必要ですねー。  
今回は game_counter という変数を定義して、使用します。

カウントするプロセスを、考えてみましょー

1. プレイヤーに 1 ~ 3 を入力してもらう
2. 選択された値の分だけ、game_counter に加算する
3. game_counter が 20 以上ならば終了する。そうでなければ 1. に戻る

こうすればカウントできますねー  
早速プログラムにしてしまいます。

```ruby
## 使用する関数を定義する
game_counter = 0 # プレイヤーが行った数字を入れる
request_num  = 0 # 選択された番号を入れる

## ゲームスタート！
loop do
  ## プレイヤーに 1 ~ 3 を入力してもらう
  puts "1~3 を入力してください"
  request_num = gets.to_i

  ## 選択された値の分だけ、game_counter に加算する
  game_counter += request_num

  ## game_counter が 20 以上ならば終了する
  ## そうでなければ続行する
  if game_counter >= 20
    puts "先ほど入力したプレイヤーが負けです！"
    break
  end
end
```

こうすることで 20 までカウントすることができるので  
一応ゲームは成立するはずです。

でもこれ 4 以上の値も入力することができちゃいますねー。  
それに、どこまで数えたのかプレイヤーが認識できないですねー。  
あと、「先攻プレイヤー」「後攻プレイヤー」という言葉が使いたいですよね？ね？

次はこれらの問題を解決していきましょー

### 2.3. 入力できる値を 1 ~ 3 に制限しよう

1 ~ 3 に制限する方法は割と簡単です！  

1. 値を入力してもらう
2. 入力された値が:
    * 1 ~ 3 の場合は次の処理（選択された値の分だけ、game_counter に加算する処理）に進む
    * それ以外ならば、1. に戻る

これをプログラム化しましょう！

```ruby
## 使用する関数を定義する
game_counter = 0 # プレイヤーが行った数字を入れる
request_num  = 0 # 選択された番号を入れる

## ゲームスタート！
loop do
  ## 選択肢を出力する
  puts "1 ~ 3 を入力してください"

  ## プレイヤーに与えられた選択肢のなかから選択してもらう
  loop do
    request_num = gets.to_i
    if 1 <= request_num && request_num <= 3
      break
    else
      puts "与えられた選択肢のなかから選択してください！"
    end
  end

  ## 選択された値の分だけ、game_counter に加算する
  game_counter += request_num

  ## game_counter が 20 以上ならば終了する
  ## そうでなければ続行する
  if game_counter >= 20
    puts "先ほど入力したプレイヤーが負けです！"
    break
  end
end
```

こうすることで、プレイヤーが 1 ~ 3 を入力するまで延々と処理を繰り返すことができるので、  
**絶対に 1 ~ 3 までの数値しか加算されない** ことになります。

これで、1 つめの問題は解決です！

### 2.4. どこまで数えたのかプレイヤーに認識させよう

20 まで数えるにはどうすれば良いのか、考えてみましょう。

えっと、まあ、要するに、カウント数が:

* 19 以下の場合は、選択肢を 1 つ用意
* 18 以下の場合は、選択肢を 2 つ用意
* 17 以下の場合は、選択肢を 3 つ用意

すれば良いですねー

これをプログラム化しましょう！

```ruby
## 使用する関数を定義する
game_counter = 0 # プレイヤーが行った数字を入れる
request_num  = 0 # 選択された番号を入れる

## ゲームスタート！
loop do
  ## 選択肢を出力する
  puts playing_player_name + "さん、 数える数字を選択してください"
  if game_counter <= 19
    print "[1] #{ game_counter+1 }"
  end
  if game_counter <= 18
    print ", [2] #{ game_counter+2 }"
  end
  if game_counter <= 17
    print ", [3] #{ game_counter+3 }"
  end
  puts # 改行

  ## プレイヤーに与えられた選択肢のなかから選択してもらう
  loop do
    request_num = gets.to_i
    if 1 <= request_num && request_num <= 3
      break
    else
      puts "与えられた選択肢のなかから選択してください！"
    end
  end

  ## 選択された値の分だけ、game_counter に加算する
  game_counter += request_num

  ## game_counter が 20 以上ならば終了する
  ## そうでなければ続行する
  if game_counter >= 20
    puts "先ほど入力したプレイヤーが負けです！"
    break
  end
end
```

とまあ、こんな感じに**ゲームカウントに合わせて出力を変化させる**ことで、実装できます！

これで、2 つめの問題は解決です！

### 2.5. どこまで数えたのかプレイヤーに認識させよう

「先攻プレイヤー」「後攻プレイヤー」を出力するように変更してみましょう。  
ますは、先攻・後攻はどうやったら対応できるか考えてみましょう。

いろいろ方法はあるのですが、今回は is_first_player_turn という変数を用意します。  
is_first_player_turn には true/false が入ります。そして: 

* 先攻プレイヤーがプレイしている場合は true
* 先攻プレイヤーがプレイしていない場合は false

を入力します。こうすることで先攻後攻を入れ替えることができますねー。

これをプログラム化しましょう！

```ruby
## 使用する関数を定義する
game_counter         = 0 # プレイヤーが行った数字を入れる
request_num          = 0 # 選択された番号を入れる
is_first_player_turn = true # 先攻プレイヤーのターンかどうかを入れる

## ゲームスタート！
loop do
  ## 自分のターンのプレイヤーの名前を出力する
  if is_first_player_turn
    print "先攻プレイヤー"
  else
    print "後攻プレイヤー"
  end

  ## 選択肢を出力する
  puts "さん、数える数字を選択してください"
  if game_counter <= 19
    print "[1] #{ game_counter+1 }"
  end
  if game_counter <= 18
    print ", [2] #{ game_counter+2 }"
  end
  if game_counter <= 17
    print ", [3] #{ game_counter+3 }"
  end
  puts # 改行

  ## プレイヤーに与えられた選択肢のなかから選択してもらう
  loop do
    request_num = gets.to_i
    if 1 <= request_num && request_num <= 3
      break
    else
      puts "与えられた選択肢のなかから選択してください！"
    end
  end

  ## 選択された値の分だけ、game_counter に加算する
  game_counter += request_num

  ## game_counter が 20 以上ならば終了する
  ## そうでなければ続行する
  if game_counter >= 20
    if is_first_player_turn
      print "後攻プレイヤー"
    else
      print "先攻プレイヤー"
    end
    puts "さんの勝利です！"
    break
  end

  ## ターンを入れ替える
  if is_first_player_turn
    is_first_player_turn = false
  else
    is_first_player_turn = true
  end
end
```

これで、3 つめの問題は解決です！  
以上で全ての問題を解決することができましたー。

完成です！！！

## 3. 応用問題

ここでは、先ほど作成したプログラムに一工夫を加えることで、  
先ほどのプログラムをバージョンアップさせる問題を出します！

是非最後の問題まで解いてください！

**[問 1]**  
ルールを変更して、**21** を数えると負けゲームにしてみましょう。  
ルールは次の通りです: 

1. プレイヤーは 2 人です
2. 1 から連続する整数を順番に数えていきます
3. 1 人は 1 度に 1 つから 3 つまでの数を数えることができます
    * 10 まで数えられていれば、次の人は 11 ~ 13 を数えることができます
4. **21** を数えてしまった人が負けです。

**[問 2]**  
**問 1** のゲームルールに変更した場合、  
これは先攻が必ず勝てるゲームですか？  
それとも後攻が必ず勝てるゲームですか？

**[問 3]**  
ルールを変更して、100 を数えると負けゲームにしてみましょう。  
ルールは次の通りです: 

1. プレイヤーは 2 人です
2. 1 から連続する整数を順番に数えていきます
3. 1 人は 1 度に **1 つから 9 つまで**の数を数えることができます
    * 10 まで数えられていれば、次の人は 11 ~ 19 を数えることができます
4. **100** を数えてしまった人が負けです

**[問 4]**  
**問 3** のゲームルールに変更した場合、  
これは先攻が必ず勝てるゲームですか？  
それとも後攻が必ず勝てるゲームですか？

**[問 5]**  
ゲームを開始する前に、プレイヤー名を入力してもらう処理を追加しましょう。  
実行例を以下に記載します。

```
$ ruby ruby_game_1/app.rb
先攻プレイヤーさん、名前を入力してください
あむろ
後攻プレイヤーさん、名前を入力してください

名前を入力してください！
しゃあ
あむろさん、数える数字を選択してください
[1] 1, [2] 2, [3] 3
3
しゃあさん、数える数字を選択してください
[1] 4, [2] 5, [3] 6
1
あむろさん、数える数字を選択してください
[1] 5, [2] 6, [3] 7
3
しゃあさん、数える数字を選択してください
[1] 8, [2] 9, [3] 10
3
あむろさん、数える数字を選択してください
[1] 11, [2] 12, [3] 13
1
しゃあさん、数える数字を選択してください
[1] 12, [2] 13, [3] 14
2
あむろさん、数える数字を選択してください
[1] 14, [2] 15, [3] 16
2
しゃあさん、数える数字を選択してください
[1] 16, [2] 17, [3] 18
3
あむろさん、数える数字を選択してください
[1] 19, [2] 20
1
しゃあさん、数える数字を選択してください
[1] 20
0
与えられた選択肢のなかから選択してください！
1
あむろさんの勝利です！
```
